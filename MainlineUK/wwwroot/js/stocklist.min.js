function loadStockList(){var n="/Stock/?handler=Json",t=$.get(n,function(t){console.log(n+" Loaded");numItems=t.stock.length;numPages=Math.ceil(numItems/numItemsPerPage);localStorage.setItem("stocklist",JSON.stringify(t));filterStocklist()});t.fail(function(){doErrorModal("Error Loading Form "+formToLoad,"The form at "+n+" returned a server error and could not be loaded")})}function filterStocklist(){curPage=1;let f=JSON.parse(localStorage.getItem("stocklist")),n=f.stock,r=$("#FilterMake").val(),u=$("#FilterModel").val(),t=$("#FilterMinPrice").val(),i=$("#FilterMaxPrice").val(),e=$("#FilterMinBudget").val(),o=$("#FilterMaxBudget").val();r.length>1&&(n=n.filter(n=>n.make===r));u.length>1&&(n=n.filter(n=>n.model===u));t.length>1&&(t=t.replace("£",""),t=t.replace(",",""),n=n.filter(n=>n.price>=t));i.length>1&&(i=i.replace("£",""),i=i.replace(",",""),n=n.filter(n=>n.price<=i));numItems=n.length;numPages=Math.ceil(numItems/numItemsPerPage);localStorage.setItem("filteredStocklist",JSON.stringify(n));displayStockList()}function displayStockList(){let n=JSON.parse(localStorage.getItem("filteredStocklist")),r=numItemsPerPage*curPage-numItemsPerPage,u=numItemsPerPage*curPage,t="";var f=new Date,i=new Date;i.setDate(f.getDate()-28);for(let f=r;f<=u;f++){if(f>=numItems)break;let r=new Date(n[f].createdDate),u=new Date(n[f].dateOfRegistration),s=("0"+r.getDate()).slice(-2)+"/"+("0"+r.getMonth()).slice(-2)+"/"+r.getFullYear(),h=("0"+u.getDate()).slice(-2)+"/"+("0"+u.getMonth()).slice(-2)+"/"+u.getFullYear(),e="";e=r>=i?`<div class="NewStock"><i class="fas fa-star"></i> New</div>`:``;let o="";o=n[f].category==="CARS"?"car":n[f].category==="COMM"?"lcv":"car";t+=`
            <div class="row">
                <div class="col Vehicle">
                    <div class="row">
                        <div class="col-md-4 align-self-center">
                            <div class="row">
                                <div class="col">
                                    ${e}
                                    ${photosHtml(n[f].stocklistImportID,n[f].photo)}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col text-center MoreDetails">
                                    <a href="#" data-toggle="modal" data-id="${n[f].stocklistImportID}" data-target="#vehicleModal" data-loading-text="${n[f].make} ${n[f].model} ${n[f].derivative} (${n[f].manufacturedYear})">More Details &gt;</a>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="row">
                                <div class="col-lg-9">
                                    <a class="OpenVehicle" href="#" data-toggle="modal" data-id="${n[f].stocklistImportID}" data-target="#vehicleModal" data-loading-text="${n[f].make} ${n[f].model} ${n[f].derivative} (${n[f].manufacturedYear})"><h2>${n[f].make} ${n[f].model}</h2></a>
                                    <a class="OpenVehicle" href="#" data-toggle="modal" data-id="${n[f].stocklistImportID}" data-target="#vehicleModal" data-loading-text="${n[f].make} ${n[f].model} ${n[f].derivative} (${n[f].manufacturedYear})"><h3>${n[f].derivative} (${n[f].manufacturedYear})</h3></a>
                                </div>
                                <div class="col-lg-3 text-right Price">
                                    <span>${getPrice(n[f].price)}</span>
                                </div>
                            </div>
                            <hr class="Divider" />
                            <div class="row">
                                <div class="col">
                                    ${getAdvert(n[f].advertDescription1)}
                                </div>
                            </div>
                            <div class="row Spacer">
                                <div class="col-md">
                                    <div class="alert alert-secondary" role="alert">
                                        <div class="row">
                                            <div class="col-md-3 col-sm-4 col-6">
                                                <i class="fas fa-cogs"></i> ${n[f].transmission}
                                            </div>
                                            <div class="col-md-3 col-sm-4 col-6">
                                                <i class="fas fa-tachometer-alt"></i> ${n[f].mileage}${n[f].mileageUnit}
                                            </div>
                                            <div class="col-md-3 col-sm-4 col-6">
                                                <i class="fas fa-palette"></i> ${n[f].colour}
                                            </div>
                                            <div class="col-md-3 col-sm-4 col-6">
                                                <i class="fas fa-gas-pump"></i> ${n[f].fuelType}
                                            </div>
                                            <div class="col-md-3 col-sm-4 col-6">
                                                <i class="fas fa-tools"></i> ${n[f].engineSize}${n[f].engineSizeUnit}
                                            </div>
                                            <div class="col-md-3 col-sm-4 col-6">
                                                <i class="fas fa-door-closed"></i> ${n[f].doors}
                                            </div>
                                            <div class="col-md-6 col-sm-8 col-12">
                                                <i class="fas fa-users"></i> ${getPreviousOwners(n[f].previousOwners)}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <script src="https://newvehicle.com/widgets/lib/finance-comparator/loader.js?username=${"sales@mainlineuk.com"}&quoteeUid=${n[f].dealerID}&class=${o}&condition=${"used"}&vrm=${n[f].registration}&registrationDate=${h}&capCode=&capId=&cashPrice=${n[f].price}&vatIncluded=true&vatQualifying=true&currentOdometerReading=${n[f].mileage}&vehicleImageUrl=https://www.mainlineuk.co.uk/stockdata/images/${n[f].stocklistImportID}/${n[f].photo[0].photoID}.jpg}&cashDepositType=&cashDeposit=&term=&annualDistance=&dateOnForecourt=${s}&usePersistedOptions=true" async></script>
                        </div>
                    </div>
                </div>
            </div>`}t+=`
        <div class="row Spacer">
            <div class="alert alert-secondary col" role="alert">
                ${pagesHtml(numPages,curPage,numPagesEitherSide)}
            </div>
        </div>`;$("#VehicleArea").html(t);listLoadedFunctions()}function listLoadedFunctions(){$(function(){return $(".carousel.lazy").on("slide.bs.carousel",function(n){var t;t=$(n.relatedTarget).find("img[data-src]");t.attr("src",t.data("src"));t.removeAttr("data-src")})});$(".PageNav").click(function(){curPage=$(this).attr("aria-label");displayStockList()});$(".OpenVehicle").click(function(){let n=$(this).attr("data-id"),t=$(this).attr("data-loading-text");$("#vehicleID").val(n);$("#modalTitleID").val(t)})}$(".Filters .Buttons").hide();loadStockList();var numItemsPerPage=10,numPagesEitherSide=3,numPages=1,curPage=1,numItems=1;pricesSlider.on("change",function(){filterStocklist()});budgetSlider.on("change",function(){filterStocklist()});$("#SearchForm select").change(function(){filterStocklist()});