function loadStockList(){var n="/Stock/?handler=Json",t=$.get(n,function(t){console.log(n+" Loaded");numItems=t.stock.length;numPages=Math.ceil(numItems/numItemsPerPage);localStorage.setItem("stocklist",JSON.stringify(t));getVehicleHPIDetails().then(n=>filterStocklist(n)).catch(n=>filterStocklist(n))});t.fail(function(){doErrorModal("Error Loading Form "+formToLoad,"The form at "+n+" returned a server error and could not be loaded")})}function filterStocklist(){return new Promise(function(n){curPage=1;let s=JSON.parse(localStorage.getItem("stocklist")),t=s.stock,e=$("#FilterMake").val(),o=$("#FilterModel").val(),i=$("#FilterMinPrice").val(),r=$("#FilterMaxPrice").val(),u=$("#FilterMinBudget").val(),f=$("#FilterMaxBudget").val();e.length>1&&(t=t.filter(n=>n.make===e));o.length>1&&(t=t.filter(n=>n.model===o));i.length>1&&(i=i.replace("£",""),i=i.replace(",",""),t=t.filter(n=>n.price>=i));r.length>1&&(r=r.replace("£",""),r=r.replace(",",""),t=t.filter(n=>n.price<=r));u.length>1&&(u=u.replace("£",""),u=u.replace(",",""),t=t.filter(n=>getMonthlyPaymentNum(n)>=u));f.length>1&&(f=f.replace("£",""),f=f.replace(",",""),t=t.filter(n=>getMonthlyPaymentNum(n)<=f));numItems=t.length;numPages=Math.ceil(numItems/numItemsPerPage);localStorage.setItem("filteredStocklist",JSON.stringify(t));displayStockList();n("Filter applied")})}function displayStockList(){return new Promise(function(n){let t=JSON.parse(localStorage.getItem("filteredStocklist")),u=numItemsPerPage*curPage-numItemsPerPage,f=numItemsPerPage*curPage-1,i="";var e=new Date,r=new Date;r.setDate(e.getDate()-28);for(let n=u;n<=f;n++){if(n>=numItems)break;let u=new Date(t[n].createdDate),f=new Date(t[n].dateOfRegistration),s=("0"+u.getDate()).slice(-2)+"/"+("0"+u.getMonth()).slice(-2)+"/"+u.getFullYear(),h=("0"+f.getDate()).slice(-2)+"/"+("0"+f.getMonth()).slice(-2)+"/"+f.getFullYear(),e="";e=u>=r?`<div class="NewStock"><i class="fas fa-star"></i> New</div>`:``;let o="";o=t[n].category==="CARS"?"car":t[n].category==="COMM"?"lcv":"car";i+=`
                <div class="row">
                    <div class="col Vehicle">
                        <div class="row">
                            <div class="col-md-4 align-self-center">
                                <div class="row">
                                    <div class="col">
                                        ${e}
                                        ${photosHtml(t[n].stocklistImportID,t[n].photo)}
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col text-center MoreDetails">
                                        <a href="#" data-toggle="modal" data-id="${t[n].stocklistImportID}" data-target="#vehicleModal" data-loading-text="${t[n].make} ${t[n].model} ${t[n].derivative} (${t[n].manufacturedYear})">
                                            More Details <i class="fas fa-arrow-circle-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="row">
                                    <div class="col-lg-9">
                                        <a class="OpenVehicle" href="#" data-toggle="modal" data-id="${t[n].stocklistImportID}" data-target="#vehicleModal" data-loading-text="${t[n].make} ${t[n].model} ${t[n].derivative} (${t[n].manufacturedYear})"><h2>${t[n].make} ${t[n].model}</h2></a>
                                        <a class="OpenVehicle" href="#" data-toggle="modal" data-id="${t[n].stocklistImportID}" data-target="#vehicleModal" data-loading-text="${t[n].make} ${t[n].model} ${t[n].derivative} (${t[n].manufacturedYear})"><h3>${t[n].derivative} (${t[n].manufacturedYear})</h3></a>
                                    </div>
                                    <div class="col-lg-3 text-right Price">
                                        <span>${getPrice(t[n].price)}</span>
                                    </div>
                                </div>
                                <hr class="Divider" />
                                <div class="row">
                                    <div class="col">
                                        ${getAdvert(t[n].advertDescription1)}
                                    </div>
                                </div>
                                <div class="row Spacer">
                                    <div class="col-md">
                                        <div class="alert alert-secondary" role="alert">
                                            <div class="row">
                                                <div class="col-md-3 col-sm-4 col-6">
                                                    <i class="fas fa-cogs"></i> ${t[n].transmission}
                                                </div>
                                                <div class="col-md-3 col-sm-4 col-6">
                                                    <i class="fas fa-tachometer-alt"></i> ${t[n].mileage}${t[n].mileageUnit}
                                                </div>
                                                <div class="col-md-3 col-sm-4 col-6">
                                                    <i class="fas fa-palette"></i> ${t[n].colour}
                                                </div>
                                                <div class="col-md-3 col-sm-4 col-6">
                                                    <i class="fas fa-gas-pump"></i> ${t[n].fuelType}
                                                </div>
                                                <div class="col-md-3 col-sm-4 col-6">
                                                    <i class="fas fa-tools"></i> ${t[n].engineSize}${t[n].engineSizeUnit}
                                                </div>
                                                <div class="col-md-3 col-sm-4 col-6">
                                                    <i class="fas fa-door-closed"></i> ${t[n].doors}
                                                </div>
                                                <div class="col-md-6 col-sm-8 col-12">
                                                    <i class="fas fa-users"></i> ${getPreviousOwners(t[n].previousOwners)}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row Spacer">
                            <div class="col">
                                ${monthlyPaymentsHtml(t[n].stocklistImportID,t[n].FinanceProductResults)}
                            </div>
                        </div>
                    </div>
                </div>`}i+=`
            <div class="row Spacer">
                <div class="alert alert-secondary col" role="alert">
                    ${pagesHtml(numPages,curPage,numPagesEitherSide)}
                </div>
            </div>`;$("#VehicleArea").html(i);listLoadedFunctions();n("Stock loaded")})}function listLoadedFunctions(){$(function(){return $(".carousel.lazy").on("slide.bs.carousel",function(n){var t;t=$(n.relatedTarget).find("img[data-src]");t.attr("src",t.data("src"));t.removeAttr("data-src")})});$(".PageNav").click(function(){curPage=$(this).attr("aria-label");displayStockList()});$(".OpenVehicle").click(function(){let n=$(this).attr("data-id"),t=$(this).attr("data-loading-text");$("#vehicleID").val(n);$("#modalTitleID").val(t)})}var iVendi={terms:"48",mileages:"10000",deposits:"500, 1000"};$(".Filters .Buttons").hide();loadStockList();var numItemsPerPage=10,numPagesEitherSide=3,numPages=1,curPage=1,numItems=1;pricesSlider.on("change",function(){filterStocklist()});budgetSlider.on("change",function(){filterStocklist()});$("#SearchForm select").change(function(){filterStocklist()});